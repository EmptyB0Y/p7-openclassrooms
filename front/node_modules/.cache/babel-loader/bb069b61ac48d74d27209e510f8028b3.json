{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LILKETRU\\\\Desktop\\\\openclassrooms\\\\P7\\\\Groupomania\\\\front\\\\src\\\\components\\\\Comments.js\",\n    _s = $RefreshSig$();\n\nimport Trash from '../assets/Icons/Trash.webp';\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { DelComment, GetComments, PostComment } from '../services/comments.service';\nimport { SearchProfiles } from '../services/profiles.service';\nimport { Profile } from './Profile';\nimport { Top } from './Top';\nimport { GifSearch } from './GifSearch';\nimport TextareaAutosize from 'react-textarea-autosize';\nimport ReactDOM from 'react-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Comments = id => {\n  _s();\n\n  const [comments, setComments] = useState([]);\n  const [change, setChange] = useState(false);\n  const [load, setLoad] = useState(false);\n  const [profiles, setProfiles] = useState({});\n\n  let commentsElement = /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 17,\n    columnNumber: 28\n  }, this);\n\n  const getFirstname = userId => {\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].firstname;\n    }\n\n    return \"Loading...\";\n  };\n\n  const getLastname = userId => {\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].lastname;\n    }\n\n    return \"\";\n  };\n\n  const getProfilePic = userId => {\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].pictureUrl;\n    }\n\n    return \"\";\n  };\n\n  const getAccess = userId => {\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].access;\n    }\n\n    return \"none\";\n  };\n\n  const refresh = () => {\n    setChange(!change);\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    let text = e.target['input'].value;\n    e.target['input'].value = \"\";\n    PostComment(id.id, text).then(() => {\n      refresh();\n    });\n  };\n\n  const handleClick = (e, profileId) => {\n    e.preventDefault();\n    ReactDOM.render( /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 13\n    }, this), document.getElementById('root'));\n    setTimeout(() => {\n      ReactDOM.render( /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Top, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Profile, {\n          id: profileId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 17\n      }, this), document.getElementById('root'));\n    }, 100);\n  };\n\n  const handleClickDelete = e => {\n    let commentId = ReactDOM.findDOMNode(e.target).parentNode.id;\n\n    if (commentId === '') {\n      commentId = ReactDOM.findDOMNode(e.target).parentNode.parentNode.id;\n    }\n\n    DelComment(commentId).then(() => {\n      refresh();\n    });\n  };\n\n  function handleClickGifs() {\n    let postId = id.id;\n    console.log(postId);\n    ReactDOM.render( /*#__PURE__*/_jsxDEV(GifSearch, {\n      place: id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 25\n    }, this), document.getElementById('gif-anchor-' + String(postId)));\n  }\n\n  const formatContent = text => {\n    const tab = text.split(' ');\n    let content = [];\n    console.log(tab);\n    let string = '';\n\n    for (let i = 0; i < tab.length; i++) {\n      if (tab[i].startsWith(':') && tab[i].endsWith(':')) {\n        content.push( /*#__PURE__*/_jsxDEV(\"p\", {\n          children: string\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 31\n        }, this));\n        string = '';\n        content.push( /*#__PURE__*/_jsxDEV(\"img\", {\n          src: tab[i].substring(1, tab[i].length - 1)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 31\n        }, this));\n      } else {\n        string += ' ' + tab[i];\n      }\n    }\n\n    if (string !== '') {\n      content.push( /*#__PURE__*/_jsxDEV(\"p\", {\n        children: string\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 27\n      }, this));\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: content.map(el => el)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 17\n    }, this);\n  };\n\n  useEffect(() => {\n    GetComments(id).then(data => {\n      setComments(data);\n    }).catch(err => console.log(err));\n  }, [change]);\n  useEffect(() => {\n    let authorUserIds = [];\n\n    for (let i = 0; i < comments.length; i++) {\n      if (!authorUserIds.includes(comments[i].author)) {\n        authorUserIds.push(comments[i].author);\n      }\n    }\n\n    authorUserIds.push(sessionStorage.getItem(\"userId\"));\n    SearchProfiles(authorUserIds).then(data => {\n      setProfiles(data);\n\n      if (comments.length > 0) {\n        setLoad(true);\n      }\n    }).catch(err => console.log(err));\n  }, [comments]);\n\n  if (load) {\n    let deleteCommentElement = {};\n    deleteCommentElement[sessionStorage.getItem(\"userId\")] = /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"delete-comment\",\n      onClick: e => handleClickDelete(e),\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"delete-comment-icon\",\n        src: Trash,\n        width: \"10\",\n        height: \"10\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 140\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 67\n    }, this);\n\n    if (getAccess(sessionStorage.getItem(\"userId\")) === \"admin\") {\n      for (let i = 0; i < comments.length; i++) {\n        deleteCommentElement[comments[i].author] = deleteCommentElement[sessionStorage.getItem(\"userId\")];\n      }\n    }\n\n    commentsElement = /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: comments.map(comment => /*#__PURE__*/_jsxDEV(\"li\", {\n        className: \"comment\",\n        id: comment.uid,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"comment-profile-picture-frame\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            className: \"comment-profile-picture\",\n            src: getProfilePic(comment.author)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"comment-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"#\",\n            className: \"comment-author\",\n            onClick: e => handleClick(e, comment.author),\n            children: [getFirstname(comment.author), \" \", getLastname(comment.author)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 25\n          }, this), \"~\", formatContent(comment.text)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 21\n        }, this), deleteCommentElement[comment.author]]\n      }, comment.uid, true, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 17\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (comments.length === 0) {\n    commentsElement = /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No comments yet...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 28\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"commments-frame\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"comments-frame-content\",\n      children: commentsElement\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"add-comment\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"add-comment-form\",\n        onSubmit: e => {\n          handleSubmit(e);\n        },\n        children: [/*#__PURE__*/_jsxDEV(TextareaAutosize, {\n          role: \"textbox\",\n          placeholder: \"Add comment\",\n          name: \"input\",\n          id: 'comment-input-' + id,\n          className: \"add-comment-input\",\n          rows: \"2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"add-comment-button\",\n          children: \"POST\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"gifs\",\n          onClick: handleClickGifs,\n          children: \"GIFS\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: 'gif-anchor-' + id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 176,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Comments, \"cypH1nGrKd36csIK9YwURPNLvC8=\");\n\n_c = Comments;\n\nvar _c;\n\n$RefreshReg$(_c, \"Comments\");","map":{"version":3,"sources":["C:/Users/LILKETRU/Desktop/openclassrooms/P7/Groupomania/front/src/components/Comments.js"],"names":["Trash","useState","useEffect","useRef","useCallback","DelComment","GetComments","PostComment","SearchProfiles","Profile","Top","GifSearch","TextareaAutosize","ReactDOM","Comments","id","comments","setComments","change","setChange","load","setLoad","profiles","setProfiles","commentsElement","getFirstname","userId","undefined","firstname","getLastname","lastname","getProfilePic","pictureUrl","getAccess","access","refresh","handleSubmit","e","preventDefault","text","target","value","then","handleClick","profileId","render","document","getElementById","setTimeout","handleClickDelete","commentId","findDOMNode","parentNode","handleClickGifs","postId","console","log","String","formatContent","tab","split","content","string","i","length","startsWith","endsWith","push","substring","map","el","data","catch","err","authorUserIds","includes","author","sessionStorage","getItem","deleteCommentElement","comment","uid"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,4BAAlB;AACA,SAASC,QAAT,EAAmBC,SAAnB,EAA8BC,MAA9B,EAAsCC,WAAtC,QAAyD,OAAzD;AACA,SAAQC,UAAR,EAAoBC,WAApB,EAAgCC,WAAhC,QAAkD,8BAAlD;AACA,SAAQC,cAAR,QAA6B,8BAA7B;AACA,SAAQC,OAAR,QAAsB,WAAtB;AACA,SAASC,GAAT,QAAoB,OAApB;AACA,SAAQC,SAAR,QAAwB,aAAxB;AACA,OAAOC,gBAAP,MAA6B,yBAA7B;AACA,OAAOC,QAAP,MAAqB,WAArB;;AAEA,OAAO,MAAMC,QAAQ,GAAIC,EAAD,IAAQ;AAAA;;AAC5B,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BhB,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAACiB,MAAD,EAASC,SAAT,IAAsBlB,QAAQ,CAAC,KAAD,CAApC;AACA,QAAM,CAACmB,IAAD,EAAMC,OAAN,IAAiBpB,QAAQ,CAAC,KAAD,CAA/B;AACA,QAAM,CAACqB,QAAD,EAAWC,WAAX,IAA0BtB,QAAQ,CAAC,EAAD,CAAxC;;AAEA,MAAIuB,eAAe,gBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAvB;;AAEA,QAAMC,YAAY,GAAIC,MAAD,IAAW;AAC5B,QAAGJ,QAAQ,CAACI,MAAD,CAAR,KAAqBC,SAAxB,EAAkC;AAC9B,aAAOL,QAAQ,CAACI,MAAD,CAAR,CAAiBE,SAAxB;AACH;;AACD,WAAO,YAAP;AACH,GALD;;AAOA,QAAMC,WAAW,GAAIH,MAAD,IAAW;AAC3B,QAAGJ,QAAQ,CAACI,MAAD,CAAR,KAAqBC,SAAxB,EAAkC;AAC9B,aAAOL,QAAQ,CAACI,MAAD,CAAR,CAAiBI,QAAxB;AACH;;AACD,WAAO,EAAP;AACH,GALD;;AAOA,QAAMC,aAAa,GAAIL,MAAD,IAAW;AAC7B,QAAGJ,QAAQ,CAACI,MAAD,CAAR,KAAqBC,SAAxB,EAAkC;AAC9B,aAAOL,QAAQ,CAACI,MAAD,CAAR,CAAiBM,UAAxB;AACH;;AACD,WAAO,EAAP;AACH,GALD;;AAOA,QAAMC,SAAS,GAAIP,MAAD,IAAW;AACzB,QAAGJ,QAAQ,CAACI,MAAD,CAAR,KAAqBC,SAAxB,EAAkC;AAC9B,aAAOL,QAAQ,CAACI,MAAD,CAAR,CAAiBQ,MAAxB;AACH;;AACD,WAAO,MAAP;AACH,GALD;;AAOA,QAAMC,OAAO,GAAG,MAAM;AAClBhB,IAAAA,SAAS,CAAC,CAACD,MAAF,CAAT;AACD,GAFH;;AAIA,QAAMkB,YAAY,GAAIC,CAAD,IAAO;AACxBA,IAAAA,CAAC,CAACC,cAAF;AACA,QAAIC,IAAI,GAAGF,CAAC,CAACG,MAAF,CAAS,OAAT,EAAkBC,KAA7B;AACAJ,IAAAA,CAAC,CAACG,MAAF,CAAS,OAAT,EAAkBC,KAAlB,GAA0B,EAA1B;AACAlC,IAAAA,WAAW,CAACQ,EAAE,CAACA,EAAJ,EAAOwB,IAAP,CAAX,CACCG,IADD,CACM,MAAM;AAAEP,MAAAA,OAAO;AAAG,KADxB;AAEH,GAND;;AAQA,QAAMQ,WAAW,GAAG,CAACN,CAAD,EAAGO,SAAH,KAAiB;AACjCP,IAAAA,CAAC,CAACC,cAAF;AACAzB,IAAAA,QAAQ,CAACgC,MAAT,eACI;AAAA;AAAA;AAAA;AAAA,YADJ,EAGMC,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CAHN;AAKAC,IAAAA,UAAU,CAAC,MAAM;AACbnC,MAAAA,QAAQ,CAACgC,MAAT,eACI;AAAA,gCACI,QAAC,GAAD;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI,QAAC,OAAD;AAAS,UAAA,EAAE,EAAED;AAAb;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,EAKME,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CALN;AAOD,KARO,EAQL,GARK,CAAV;AAUH,GAjBD;;AAkBA,QAAME,iBAAiB,GAAIZ,CAAD,IAAO;AAC7B,QAAIa,SAAS,GAAGrC,QAAQ,CAACsC,WAAT,CAAqBd,CAAC,CAACG,MAAvB,EAA+BY,UAA/B,CAA0CrC,EAA1D;;AACA,QAAGmC,SAAS,KAAK,EAAjB,EAAoB;AAChBA,MAAAA,SAAS,GAAGrC,QAAQ,CAACsC,WAAT,CAAqBd,CAAC,CAACG,MAAvB,EAA+BY,UAA/B,CAA0CA,UAA1C,CAAqDrC,EAAjE;AACH;;AACDV,IAAAA,UAAU,CAAC6C,SAAD,CAAV,CACCR,IADD,CACM,MAAI;AAAEP,MAAAA,OAAO;AAAI,KADvB;AAEH,GAPD;;AASA,WAASkB,eAAT,GAA0B;AACtB,QAAIC,MAAM,GAAGvC,EAAE,CAACA,EAAhB;AACAwC,IAAAA,OAAO,CAACC,GAAR,CAAYF,MAAZ;AACAzC,IAAAA,QAAQ,CAACgC,MAAT,eAAgB,QAAC,SAAD;AAAW,MAAA,KAAK,EAAE9B;AAAlB;AAAA;AAAA;AAAA;AAAA,YAAhB,EAAyC+B,QAAQ,CAACC,cAAT,CAAwB,gBAAcU,MAAM,CAACH,MAAD,CAA5C,CAAzC;AACH;;AAED,QAAMI,aAAa,GAAInB,IAAD,IAAS;AAC3B,UAAMoB,GAAG,GAAGpB,IAAI,CAACqB,KAAL,CAAW,GAAX,CAAZ;AACA,QAAIC,OAAO,GAAG,EAAd;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAYG,GAAZ;AACA,QAAIG,MAAM,GAAG,EAAb;;AACA,SAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGJ,GAAG,CAACK,MAAvB,EAA+BD,CAAC,EAAhC,EAAmC;AAC/B,UAAGJ,GAAG,CAACI,CAAD,CAAH,CAAOE,UAAP,CAAkB,GAAlB,KAA0BN,GAAG,CAACI,CAAD,CAAH,CAAOG,QAAP,CAAgB,GAAhB,CAA7B,EAAkD;AAC9CL,QAAAA,OAAO,CAACM,IAAR,eAAc;AAAA,oBAAIL;AAAJ;AAAA;AAAA;AAAA;AAAA,gBAAd;AACAA,QAAAA,MAAM,GAAG,EAAT;AACAD,QAAAA,OAAO,CAACM,IAAR,eAAc;AAAK,UAAA,GAAG,EAAER,GAAG,CAACI,CAAD,CAAH,CAAOK,SAAP,CAAiB,CAAjB,EAAmBT,GAAG,CAACI,CAAD,CAAH,CAAOC,MAAP,GAAc,CAAjC;AAAV;AAAA;AAAA;AAAA;AAAA,gBAAd;AACH,OAJD,MAKI;AACAF,QAAAA,MAAM,IAAI,MAAIH,GAAG,CAACI,CAAD,CAAjB;AACH;AACJ;;AAED,QAAGD,MAAM,KAAK,EAAd,EAAiB;AACbD,MAAAA,OAAO,CAACM,IAAR,eAAc;AAAA,kBAAIL;AAAJ;AAAA;AAAA;AAAA;AAAA,cAAd;AACH;;AAED,wBAAQ;AAAA,gBACHD,OAAO,CAACQ,GAAR,CAAaC,EAAD,IAAMA,EAAlB;AADG;AAAA;AAAA;AAAA;AAAA,YAAR;AAGH,GAvBD;;AAyBApE,EAAAA,SAAS,CAAC,MAAM;AACZI,IAAAA,WAAW,CAACS,EAAD,CAAX,CACC2B,IADD,CACM6B,IAAI,IAAI;AACVtD,MAAAA,WAAW,CAACsD,IAAD,CAAX;AACH,KAHD,EAICC,KAJD,CAIQC,GAAD,IAASlB,OAAO,CAACC,GAAR,CAAYiB,GAAZ,CAJhB;AAKD,GANM,EAMJ,CAACvD,MAAD,CANI,CAAT;AAQEhB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIwE,aAAa,GAAG,EAApB;;AACA,SAAI,IAAIX,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG/C,QAAQ,CAACgD,MAA5B,EAAoCD,CAAC,EAArC,EAAwC;AACpC,UAAG,CAAEW,aAAa,CAACC,QAAd,CAAuB3D,QAAQ,CAAC+C,CAAD,CAAR,CAAYa,MAAnC,CAAL,EAAiD;AAC7CF,QAAAA,aAAa,CAACP,IAAd,CAAmBnD,QAAQ,CAAC+C,CAAD,CAAR,CAAYa,MAA/B;AACH;AACJ;;AACDF,IAAAA,aAAa,CAACP,IAAd,CAAmBU,cAAc,CAACC,OAAf,CAAuB,QAAvB,CAAnB;AAEAtE,IAAAA,cAAc,CAACkE,aAAD,CAAd,CACChC,IADD,CACM6B,IAAI,IAAI;AACVhD,MAAAA,WAAW,CAACgD,IAAD,CAAX;;AACA,UAAGvD,QAAQ,CAACgD,MAAT,GAAkB,CAArB,EAAuB;AACnB3C,QAAAA,OAAO,CAAC,IAAD,CAAP;AACH;AACH,KANF,EAOCmD,KAPD,CAOQC,GAAD,IAASlB,OAAO,CAACC,GAAR,CAAYiB,GAAZ,CAPhB;AAQD,GAjBQ,EAiBN,CAACzD,QAAD,CAjBM,CAAT;;AAmBF,MAAGI,IAAH,EAAQ;AACJ,QAAI2D,oBAAoB,GAAG,EAA3B;AACAA,IAAAA,oBAAoB,CAACF,cAAc,CAACC,OAAf,CAAuB,QAAvB,CAAD,CAApB,gBAA0D;AAAQ,MAAA,SAAS,EAAC,gBAAlB;AAAmC,MAAA,OAAO,EAAGzC,CAAD,IAAOY,iBAAiB,CAACZ,CAAD,CAApE;AAAA,6BAAyE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAqC,QAAA,GAAG,EAAErC,KAA1C;AAAiD,QAAA,KAAK,EAAC,IAAvD;AAA4D,QAAA,MAAM,EAAC;AAAnE;AAAA;AAAA;AAAA;AAAA;AAAzE;AAAA;AAAA;AAAA;AAAA,YAA1D;;AACA,QAAGiC,SAAS,CAAC4C,cAAc,CAACC,OAAf,CAAuB,QAAvB,CAAD,CAAT,KAAgD,OAAnD,EAA2D;AACvD,WAAI,IAAIf,CAAC,GAAG,CAAZ,EAAcA,CAAC,GAAG/C,QAAQ,CAACgD,MAA3B,EAAmCD,CAAC,EAApC,EAAuC;AACnCgB,QAAAA,oBAAoB,CAAC/D,QAAQ,CAAC+C,CAAD,CAAR,CAAYa,MAAb,CAApB,GAA2CG,oBAAoB,CAACF,cAAc,CAACC,OAAf,CAAuB,QAAvB,CAAD,CAA/D;AACH;AACJ;;AAEDtD,IAAAA,eAAe,gBACX;AAAA,gBACCR,QAAQ,CAACqD,GAAT,CAAcW,OAAD,iBACV;AAAI,QAAA,SAAS,EAAC,SAAd;AAA0C,QAAA,EAAE,EAAEA,OAAO,CAACC,GAAtD;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,+BAAf;AAAA,iCACI;AAAK,YAAA,SAAS,EAAC,yBAAf;AAAyC,YAAA,GAAG,EAAElD,aAAa,CAACiD,OAAO,CAACJ,MAAT;AAA3D;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBADJ,eAII;AAAK,UAAA,SAAS,EAAC,iBAAf;AAAA,kCACI;AAAG,YAAA,IAAI,EAAC,GAAR;AAAY,YAAA,SAAS,EAAC,gBAAtB;AAAuC,YAAA,OAAO,EAAGvC,CAAD,IAAOM,WAAW,CAACN,CAAD,EAAG2C,OAAO,CAACJ,MAAX,CAAlE;AAAA,uBAAuFnD,YAAY,CAACuD,OAAO,CAACJ,MAAT,CAAnG,OAAsH/C,WAAW,CAACmD,OAAO,CAACJ,MAAT,CAAjI;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,OAEKlB,aAAa,CAACsB,OAAO,CAACzC,IAAT,CAFlB;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJJ,EAQKwC,oBAAoB,CAACC,OAAO,CAACJ,MAAT,CARzB;AAAA,SAA6BI,OAAO,CAACC,GAArC;AAAA;AAAA;AAAA;AAAA,cADH;AADD;AAAA;AAAA;AAAA;AAAA,YADJ;AAeH;;AAGD,MAAGjE,QAAQ,CAACgD,MAAT,KAAoB,CAAvB,EAAyB;AACrBxC,IAAAA,eAAe,gBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAnB;AACH;;AAED,sBACA;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAA,4BACI;AAAK,MAAA,SAAS,EAAC,wBAAf;AAAA,gBACKA;AADL;AAAA;AAAA;AAAA;AAAA,YADJ,eAII;AAAK,MAAA,SAAS,EAAC,aAAf;AAAA,6BACI;AAAM,QAAA,SAAS,EAAC,kBAAhB;AAAmC,QAAA,QAAQ,EAAGa,CAAD,IAAO;AAACD,UAAAA,YAAY,CAACC,CAAD,CAAZ;AAAgB,SAArE;AAAA,gCACI,QAAC,gBAAD;AAAkB,UAAA,IAAI,EAAC,SAAvB;AAAiC,UAAA,WAAW,EAAC,aAA7C;AAA2D,UAAA,IAAI,EAAC,OAAhE;AAAwE,UAAA,EAAE,EAAE,mBAAiBtB,EAA7F;AAAiG,UAAA,SAAS,EAAC,mBAA3G;AAA+H,UAAA,IAAI,EAAC;AAApI;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI;AAAQ,UAAA,SAAS,EAAC,oBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFJ,eAGI;AAAG,UAAA,SAAS,EAAC,MAAb;AAAoB,UAAA,OAAO,EAAEsC,eAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAHJ,eAII;AAAK,UAAA,EAAE,EAAE,gBAActC;AAAvB;AAAA;AAAA;AAAA;AAAA,gBAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,YAJJ;AAAA;AAAA;AAAA;AAAA;AAAA,UADA;AAeH,CAnLM;;GAAMD,Q;;KAAAA,Q","sourcesContent":["import Trash from '../assets/Icons/Trash.webp'\r\nimport { useState, useEffect, useRef, useCallback } from 'react'\r\nimport {DelComment, GetComments,PostComment} from '../services/comments.service'\r\nimport {SearchProfiles} from '../services/profiles.service'\r\nimport {Profile} from './Profile'\r\nimport { Top } from './Top'\r\nimport {GifSearch} from './GifSearch'\r\nimport TextareaAutosize from 'react-textarea-autosize';\r\nimport ReactDOM from 'react-dom'\r\n\r\nexport const Comments = (id) => {\r\n    const [comments, setComments] = useState([]);\r\n    const [change, setChange] = useState(false);\r\n    const [load,setLoad] = useState(false);\r\n    const [profiles, setProfiles] = useState({});\r\n\r\n    let commentsElement = (<p>Loading...</p>);\r\n\r\n    const getFirstname = (userId) =>{\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].firstname;\r\n        }\r\n        return(\"Loading...\");\r\n    }\r\n\r\n    const getLastname = (userId) =>{\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].lastname;\r\n        }\r\n        return(\"\");\r\n    }\r\n\r\n    const getProfilePic = (userId) =>{\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].pictureUrl;\r\n        }\r\n        return(\"\");\r\n    }\r\n\r\n    const getAccess = (userId) =>{\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].access;\r\n        }\r\n        return(\"none\");\r\n    }\r\n\r\n    const refresh = () => {\r\n        setChange(!change);\r\n      }\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        let text = e.target['input'].value; \r\n        e.target['input'].value = \"\";\r\n        PostComment(id.id,text)\r\n        .then(() => { refresh()});\r\n    }\r\n\r\n    const handleClick = (e,profileId) => {\r\n        e.preventDefault();\r\n        ReactDOM.render(\r\n            <div>\r\n            </div>,\r\n              document.getElementById('root')\r\n        );\r\n        setTimeout(() => {\r\n            ReactDOM.render(\r\n                <div>\r\n                    <Top />\r\n                    <Profile id={profileId} />\r\n                </div>,\r\n                  document.getElementById('root')\r\n            );\r\n          }, 100);\r\n\r\n    }\r\n    const handleClickDelete = (e) => {\r\n        let commentId = ReactDOM.findDOMNode(e.target).parentNode.id;\r\n        if(commentId === ''){\r\n            commentId = ReactDOM.findDOMNode(e.target).parentNode.parentNode.id\r\n        }\r\n        DelComment(commentId)\r\n        .then(()=>{ refresh() });\r\n    }\r\n\r\n    function handleClickGifs(){\r\n        let postId = id.id;\r\n        console.log(postId);\r\n        ReactDOM.render(<GifSearch place={id}/>, document.getElementById('gif-anchor-'+String(postId)));\r\n    }\r\n\r\n    const formatContent = (text) =>{\r\n        const tab = text.split(' ');\r\n        let content = [];\r\n        console.log(tab);\r\n        let string = '';\r\n        for(let i = 0; i < tab.length; i++){\r\n            if(tab[i].startsWith(':') && tab[i].endsWith(':')){\r\n                content.push((<p>{string}</p>));\r\n                string = '';\r\n                content.push((<img src={tab[i].substring(1,tab[i].length-1)}></img>));\r\n            }\r\n            else{\r\n                string += ' '+tab[i];\r\n            }\r\n        }\r\n\r\n        if(string !== ''){\r\n            content.push((<p>{string}</p>));\r\n        }\r\n\r\n        return (<div>\r\n            {content.map((el)=>el)}\r\n        </div>);\r\n    }\r\n\r\n    useEffect(() => {\r\n        GetComments(id)\r\n        .then(data => {\r\n            setComments(data);\r\n        })\r\n        .catch((err) => console.log(err)) \r\n      }, [change]);\r\n\r\n      useEffect(() => {\r\n        let authorUserIds = []\r\n        for(let i = 0; i < comments.length; i++){\r\n            if(!(authorUserIds.includes(comments[i].author))){\r\n                authorUserIds.push(comments[i].author);\r\n            }\r\n        }\r\n        authorUserIds.push(sessionStorage.getItem(\"userId\"));\r\n\r\n        SearchProfiles(authorUserIds)\r\n        .then(data => {\r\n            setProfiles(data);\r\n            if(comments.length > 0){\r\n                setLoad(true);\r\n            }       \r\n         })\r\n        .catch((err) => console.log(err));\r\n      }, [comments]);\r\n    \r\n    if(load){\r\n        let deleteCommentElement = {};\r\n        deleteCommentElement[sessionStorage.getItem(\"userId\")] = (<button className='delete-comment' onClick={(e) => handleClickDelete(e)}><img className='delete-comment-icon' src={Trash} width='10' height='10'></img></button>);\r\n        if(getAccess(sessionStorage.getItem(\"userId\")) === \"admin\"){\r\n            for(let i = 0;i < comments.length; i++){\r\n                deleteCommentElement[comments[i].author] = deleteCommentElement[sessionStorage.getItem(\"userId\")];\r\n            }\r\n        }\r\n\r\n        commentsElement = (\r\n            <ul>\r\n            {comments.map((comment) =>\r\n                <li className='comment' key={comment.uid} id={comment.uid}>\r\n                    <div className='comment-profile-picture-frame'>\r\n                        <img className='comment-profile-picture' src={getProfilePic(comment.author)}></img>\r\n                    </div>\r\n                    <div className='comment-content'>\r\n                        <a href='#' className='comment-author' onClick={(e) => handleClick(e,comment.author)}>{getFirstname(comment.author)} {getLastname(comment.author)}</a>~\r\n                        {formatContent(comment.text)}\r\n                    </div>\r\n                    {deleteCommentElement[comment.author]}\r\n                </li>)}\r\n            </ul>\r\n        );\r\n    }\r\n\r\n\r\n    if(comments.length === 0){\r\n        commentsElement = (<p>No comments yet...</p>);\r\n    }\r\n\r\n    return (\r\n    <div className='commments-frame'>\r\n        <div className='comments-frame-content'>\r\n            {commentsElement}\r\n        </div>\r\n        <div className='add-comment'>\r\n            <form className='add-comment-form' onSubmit={(e) => {handleSubmit(e)}}>\r\n                <TextareaAutosize role='textbox' placeholder=\"Add comment\" name='input' id={'comment-input-'+id} className='add-comment-input' rows=\"2\"/>\r\n                <button className='add-comment-button'>POST</button>\r\n                <a className='gifs' onClick={handleClickGifs}>GIFS</a>\r\n                <div id={'gif-anchor-'+id}></div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}