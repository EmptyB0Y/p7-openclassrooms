{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LILKETRU\\\\Desktop\\\\openclassrooms\\\\P7\\\\Groupomania\\\\front\\\\src\\\\components\\\\Comments.js\",\n    _s = $RefreshSig$();\n\nimport like from '../assets/Icons/like.png';\nimport nopic from '../assets/Icons/nopic.webp';\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { GetComments, PostComment } from '../services/comments.service';\nimport { SearchProfiles } from '../services/profiles.service';\nimport { Profile } from './Profile';\nimport ReactDOM from 'react-dom';\nimport { Top } from './Top';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Comments = id => {\n  _s();\n\n  const [comments, setComments] = useState([]);\n  const [change, setChange] = useState(false);\n  const [load, setLoad] = useState(false);\n  const [profiles, setProfiles] = useState({});\n\n  let commentsElement = /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 16,\n    columnNumber: 28\n  }, this);\n\n  const getFirstname = userId => {\n    console.log(profiles[userId]);\n\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].firstname;\n    }\n\n    return \"Loading...\";\n  };\n\n  const getLastname = userId => {\n    if (profiles[userId] !== undefined) {\n      return profiles[userId].lastname;\n    }\n\n    return \"\";\n  };\n\n  const refresh = () => {\n    setChange(true);\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    let text = e.target['input'].value;\n    e.target['input'].value = \"\";\n    PostComment(id.id, text).then(() => {\n      refresh();\n    });\n  };\n\n  const handleClick = e => {\n    e.preventDefault();\n    ReactDOM.render( /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Top, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Profile, {\n        id: sessionStorage.getItem(\"userId\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 13\n    }, this), document.getElementById('root'));\n  };\n\n  useEffect(() => {\n    GetComments(id).then(data => {\n      setComments(data);\n    }).catch(err => console.log(err));\n  }, [change]);\n  useEffect(() => {\n    let authorUserIds = [];\n\n    for (let i = 0; i < comments.length; i++) {\n      if (!authorUserIds.includes(comments[i].author)) {\n        authorUserIds.push(comments[i].author);\n      }\n    }\n\n    SearchProfiles(authorUserIds).then(data => {\n      setProfiles(data);\n\n      if (comments.length > 0) {\n        setLoad(true);\n      }\n    }).catch(err => console.log(err));\n  }, [comments]);\n\n  if (load) {\n    commentsElement = /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: comments.map(comment => /*#__PURE__*/_jsxDEV(\"li\", {\n        className: \"comment\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"comment-profile-picture\",\n          src: nopic\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"#\",\n              className: \"comment-author\",\n              onClick: handleClick,\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"firstname\",\n                children: getFirstname(comment.author)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 88,\n                columnNumber: 89\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"lasttname\",\n                children: [\" \", getLastname(comment.author)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 88,\n                columnNumber: 148\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 88,\n              columnNumber: 28\n            }, this), \"~\", comment.text]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 21\n        }, this)]\n      }, comment._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 17\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }, this);\n  }\n\n  if (comments.length === 0) {\n    commentsElement = /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No comments yet...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 28\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"commments-frame\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"comments-frame-content\",\n      children: commentsElement\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"add-comment\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => {\n          handleSubmit(e);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"input\",\n          className: \"add-comment-input\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"add-comment-button\",\n          children: \"post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Comments, \"cypH1nGrKd36csIK9YwURPNLvC8=\");\n\n_c = Comments;\n\nvar _c;\n\n$RefreshReg$(_c, \"Comments\");","map":{"version":3,"sources":["C:/Users/LILKETRU/Desktop/openclassrooms/P7/Groupomania/front/src/components/Comments.js"],"names":["like","nopic","useState","useEffect","useRef","useCallback","GetComments","PostComment","SearchProfiles","Profile","ReactDOM","Top","Comments","id","comments","setComments","change","setChange","load","setLoad","profiles","setProfiles","commentsElement","getFirstname","userId","console","log","undefined","firstname","getLastname","lastname","refresh","handleSubmit","e","preventDefault","text","target","value","then","handleClick","render","sessionStorage","getItem","document","getElementById","data","catch","err","authorUserIds","i","length","includes","author","push","map","comment","_id"],"mappings":"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","sourcesContent":["import like from '../assets/Icons/like.png'\r\nimport nopic from '../assets/Icons/nopic.webp'\r\nimport { useState, useEffect, useRef, useCallback } from 'react'\r\nimport {GetComments,PostComment} from '../services/comments.service'\r\nimport {SearchProfiles} from '../services/profiles.service'\r\nimport {Profile} from './Profile'\r\nimport ReactDOM from 'react-dom';\r\nimport { Top } from './Top'\r\n\r\nexport const Comments = (id) => {\r\n    const [comments, setComments] = useState([]);\r\n    const [change, setChange] = useState(false);\r\n    const [load,setLoad] = useState(false);\r\n    const [profiles, setProfiles] = useState({});\r\n\r\n    let commentsElement = (<p>Loading...</p>);\r\n\r\n    const getFirstname = (userId) =>{\r\n        console.log(profiles[userId]);\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].firstname;\r\n        }\r\n        return(\"Loading...\");\r\n    }\r\n\r\n    const getLastname = (userId) =>{\r\n        if(profiles[userId] !== undefined){\r\n            return profiles[userId].lastname;\r\n        }\r\n        return(\"\");\r\n    }\r\n\r\n    const refresh = () => {\r\n        setChange(true);\r\n      }\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        let text = e.target['input'].value; \r\n        e.target['input'].value = \"\";\r\n        PostComment(id.id,text)\r\n        .then(() => { refresh()});\r\n    }\r\n\r\n    const handleClick = (e) => {\r\n        e.preventDefault();\r\n        ReactDOM.render(\r\n            <div>\r\n                <Top />\r\n                <Profile id={sessionStorage.getItem(\"userId\")} />\r\n            </div>,\r\n              document.getElementById('root')\r\n        );\r\n    }\r\n    useEffect(() => {\r\n        GetComments(id)\r\n        .then(data => {\r\n            setComments(data);\r\n        })\r\n        .catch((err) => console.log(err)) \r\n      }, [change]);\r\n\r\n      useEffect(() => {\r\n        let authorUserIds = []\r\n        for(let i = 0; i < comments.length; i++){\r\n            if(!(authorUserIds.includes(comments[i].author))){\r\n                authorUserIds.push(comments[i].author);\r\n            }\r\n        }\r\n\r\n        SearchProfiles(authorUserIds)\r\n        .then(data => {\r\n            setProfiles(data);\r\n            if(comments.length > 0){\r\n                setLoad(true);\r\n            }       \r\n         })\r\n        .catch((err) => console.log(err));\r\n      }, [comments]);\r\n\r\n    if(load){\r\n        commentsElement = (\r\n            <ul>\r\n            {comments.map((comment) =>\r\n                <li className='comment' key={comment._id}>\r\n                    <img className='comment-profile-picture' src={nopic}></img>\r\n                    <div>\r\n                        <p><a href='#' className='comment-author' onClick={handleClick}><p className='firstname'>{getFirstname(comment.author)}</p><p className='lasttname'> {getLastname(comment.author)}</p></a>~\r\n                        {comment.text}\r\n                        </p>\r\n                    </div>\r\n                </li>)}\r\n            </ul>\r\n        );\r\n    }\r\n\r\n\r\n    if(comments.length === 0){\r\n        commentsElement = (<p>No comments yet...</p>);\r\n    }\r\n\r\n    return (\r\n    <div className='commments-frame'>\r\n        <div className='comments-frame-content'>\r\n            {commentsElement}\r\n        </div>\r\n        <div className='add-comment'>\r\n            <form onSubmit={(e) => {handleSubmit(e)}}>\r\n                <input name='input' className='add-comment-input'></input>\r\n                <button className='add-comment-button'>post</button>\r\n            </form>\r\n        </div>\r\n    </div>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}